<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Private Listening & Collaboration</title>

<meta name="robots" content="noindex,nofollow,noarchive" />
<meta name="referrer" content="no-referrer" />

<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:#0b0c10;
  color:#e8e8e8;
}
.wrap { max-width:860px; margin:40px auto; padding:0 18px; }
.card {
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:14px;
  padding:18px;
}
h1 { font-size:18px; margin:0 0 10px; font-weight:600; }
.note { font-size:12px; opacity:.85; line-height:1.6; margin-top:8px; }
.small { font-size:12px; opacity:.72; margin-top:8px; }
.hr { height:1px; background:rgba(255,255,255,0.12); margin:14px 0; }
.row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.col { flex:1 1 240px; min-width:220px; }

input, select, textarea {
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(0,0,0,0.35);
  color:#fff;
  font-size:13px;
  box-sizing:border-box;
}
textarea { height:150px; resize:vertical; }

button {
  padding:8px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(255,255,255,0.08);
  color:#fff;
  cursor:pointer;
  font-size:13px;
}
button:active { transform:translateY(1px); }

.hidden { display:none; }
.err { font-size:12px; color:#ffb3b3; margin-top:8px; display:none; }
.pill {
  display:inline-block; padding:2px 8px; border-radius:999px;
  border:1px solid rgba(255,255,255,0.16);
  background:rgba(255,255,255,0.06);
  font-size:12px;
}
.muted { opacity:.7; }
</style>
</head>

<body>
<div class="wrap">

<!-- ========== GATE ========== -->
<div class="card" id="gate">
  <h1>Private Listening (Evaluation Only)</h1>
  <div class="note">
    Private listening only. Not for distribution, reproduction, or public sharing.
  </div>

  <div class="row">
    <div class="col">
      <input id="pw" type="password" placeholder="Passcode" autocomplete="off" />
    </div>
    <div>
      <button onclick="enter()">Enter</button>
    </div>
  </div>

  <div class="err" id="err">Invalid passcode.</div>
</div>

<!-- ========== CONTENT ========== -->
<div class="card hidden" id="content">

  <div class="row" style="justify-content:space-between;align-items:flex-start">
    <div>
      <h1 style="margin:0">Listening Room</h1>
      <div class="note">
        Library: <span class="pill" id="libName">—</span>
      </div>
    </div>
    <div>
      <button onclick="lock()">Lock</button>
    </div>
  </div>

  <div class="hr"></div>

  <!-- Track selection -->
  <div class="row">
    <div class="col">
      <div class="note"><b>Select track</b></div>
      <select id="trackSelect"></select>
    </div>
    <div class="col">
      <div class="note"><b>Or type track code</b></div>
      <input id="trackInput" placeholder="e.g. A01" />
    </div>
  </div>

  <!-- Player -->
  <div class="note" style="margin-top:12px">
    Now playing: <span id="nowPlaying" class="muted">—</span>
  </div>
  <audio id="player" controls preload="none" controlsList="nodownload noplaybackrate"></audio>

  <div class="hr"></div>

  <!-- Feedback -->
  <div class="note">
    <b>Notes</b> — press <b>T</b> for timestamp, <b>Ctrl/Cmd + Enter</b> to copy
  </div>
  <textarea id="fb" placeholder="0:42 - mood works well
1:12 - vocal phrasing suggestion
Credits/splits thoughts..."></textarea>

  <div class="row">
    <button onclick="insertTimestamp()">Insert timestamp</button>
    <button onclick="copyFB()">Copy notes</button>
  </div>

  <div class="hr"></div>

  <!-- Lyrics / Ideas -->
  <div class="note">
    <b>Lyrics / Ideas</b> — paste text below
  </div>
  <textarea id="lyrics" placeholder="Paste lyrics / topline / ideas here"></textarea>

  <div class="row">
    <button onclick="copyPackage()">Copy package</button>
    <button onclick="openMail()">Send via email</button>
    <button onclick="copyWhatsApp()">Copy WhatsApp text</button>
    <button onclick="clearLyrics()">Clear</button>
  </div>

</div>

</div>

<script>
/* ================= CONFIG ================= */

// TODO 1: 曲库与口令
const LIBRARIES = {
  "A-7F3K": {
    name: "Collaborator A",
    tracks: {
      "A01": { title: "Demo 1", src: "https://goldisle.org/assets/audio/A01.mp3", src_cn: "" },
      "A02": { title: "Demo 2", src: "https://goldisle.org/assets/audio/A02.mp3", src_cn: "" }
    }
  }
};

// TODO 2: 收件邮箱
const COLLAB_EMAIL = "toptrust@gmail.com";

/* ================= STATE ================= */
let ACTIVE_LIB=null, ACTIVE_PASS=null, ACTIVE_CODE=null;

/* ================= ELEMENTS ================= */
const gateEl = document.getElementById("gate");
const contentEl = document.getElementById("content");
const errEl = document.getElementById("err");
const pwEl = document.getElementById("pw");
const libNameEl = document.getElementById("libName");
const trackSelectEl = document.getElementById("trackSelect");
const trackInputEl = document.getElementById("trackInput");
const playerEl = document.getElementById("player");
const nowPlayingEl = document.getElementById("nowPlaying");
const fbEl = document.getElementById("fb");
const lyricsEl = document.getElementById("lyrics");

/* ================= UTILS ================= */
function pad(n){return String(n).padStart(2,"0")}
function fmt(sec){sec=Math.floor(sec||0);return `${Math.floor(sec/60)}:${pad(sec%60)}`}

/* ================= GATE ================= */
function enter(){
  const pass=pwEl.value.trim();
  const lib=LIBRARIES[pass];
  if(!lib){errEl.style.display="block";return;}
  ACTIVE_LIB=lib; ACTIVE_PASS=pass;
  gateEl.classList.add("hidden");
  contentEl.classList.remove("hidden");
  libNameEl.textContent=lib.name;
  renderTracks();
}

function lock(){
  playerEl.pause();
  playerEl.src="";
  contentEl.classList.add("hidden");
  gateEl.classList.remove("hidden");
  pwEl.value="";
}

/* ================= TRACKS ================= */
function renderTracks(){
  trackSelectEl.innerHTML="";
  Object.entries(ACTIVE_LIB.tracks).forEach(([code,t])=>{
    const o=document.createElement("option");
    o.value=code;
    o.textContent=`${code} — ${t.title}`;
    trackSelectEl.appendChild(o);
  });
}

trackSelectEl.onchange=e=>play(e.target.value);
trackInputEl.onkeydown=e=>{if(e.key==="Enter")play(e.target.value.trim())};

function play(code){
  const t=ACTIVE_LIB.tracks[code];
  if(!t)return alert("Track not found");
  ACTIVE_CODE=code;
  nowPlayingEl.textContent=`${code} — ${t.title}`;
  playerEl.innerHTML="";
  ["src","src_cn"].forEach(k=>{
    if(t[k]){
      const s=document.createElement("source");
      s.src=t[k]; s.type="audio/mpeg";
      playerEl.appendChild(s);
    }
  });
  playerEl.load(); playerEl.play().catch(()=>{});
}

/* ================= FEEDBACK ================= */
function insertTimestamp(){
  fbEl.value+=`${fmt(playerEl.currentTime)} - `;
  fbEl.focus();
}
async function copyFB(){
  await navigator.clipboard.writeText(fbEl.value);
  alert("Notes copied");
}

/* ================= PACKAGE ================= */
function buildPackage(){
  return `[Private Collaboration]
Library: ${ACTIVE_LIB?.name}
Track: ${ACTIVE_CODE}

Notes:
${fbEl.value||"(none)"}

Lyrics / Ideas:
${lyricsEl.value||"(none)"}
`;
}
async function copyPackage(){
  await navigator.clipboard.writeText(buildPackage());
  alert("Package copied");
}
function openMail(){
  location.href=`mailto:${COLLAB_EMAIL}?subject=Private%20Listening&body=`+
    encodeURIComponent(buildPackage());
}
async function copyWhatsApp(){
  await navigator.clipboard.writeText(buildPackage());
  alert("WhatsApp text copied");
}
function clearLyrics(){lyricsEl.value="";}

/* ================= SHORTCUTS ================= */
fbEl.addEventListener("keydown",e=>{
  if(e.key==="t"&&!e.ctrlKey&&!e.metaKey){e.preventDefault();insertTimestamp();}
  if((e.ctrlKey||e.metaKey)&&e.key==="Enter"){e.preventDefault();copyFB();}
});
</script>
</body>
</html>
